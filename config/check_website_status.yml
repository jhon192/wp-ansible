---
- name: Diagnóstico de sintaxis Apache
  hosts: localhost          # o el grupo/host que corresponda
  become: true
  vars:
    ansible_remote_tmp: "/tmp/.ansible-123324453"
  tasks:

    # 1) Deshabilita el módulo ‘security2’
    - name: Ejecutar a2dismod security2
      command: a2dismod security2
      args:
        creates: "/etc/apache2/mods-disabled/security2.load"   # evita repetir si ya está deshabilitado
      register: disable_modsec
      changed_when: disable_modsec.rc == 0

    # 2) Recargar Apache para aplicar el cambio
    - name: Recargar Apache si ModSecurity fue deshabilitado
      service:
        name: apache2
        state: reloaded
      when: disable_modsec.rc == 0
