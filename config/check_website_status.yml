---
- name: Reemplazar index.php con contenido WordPress
  hosts: localhost
  become: true

  vars:
    ansible_remote_tmp: "/tmp/.ansible-123324453"
  tasks:

  - name: Buscar todos los wp-config.php
    find:
      paths: /home/semaphore
      recurse: yes
      patterns: wp-config.php
    register: wp_configs
    
  - name: Habilitar WP_DEBUG
    lineinfile:
      path: "{{ item.path }}"
      regexp: "define\\('WP_DEBUG',.*\\);"
      line: "define('WP_DEBUG', true);"
      insertafter: "/* That's all, stop editing! Happy publishing. */"
      backup: yes
    loop: "{{ wp_configs.files }}"
    
  - name: Asegurar otras constantes de debug
    blockinfile:
      path: "{{ item.path }}"
      marker: "# {mark} ANSIBLE DEBUG SETTINGS"
      block: |
        define('WP_DEBUG_DISPLAY', true);
        define('WP_DEBUG_LOG', true);
    loop: "{{ wp_configs.files }}"
