---
- name: Diagnóstico de sintaxis Apache
  hosts: localhost          # o el grupo/host que corresponda
  become: true
  vars:
    ansible_remote_tmp: "/tmp/.ansible-123324453"
  tasks:

    - name: 1️⃣  Ejecutar apachectl configtest
      shell: apachectl configtest 2>&1
      register: configtest

    - name: 2️⃣  Mostrar resultado completo del configtest
      debug:
        msg: "{{ configtest.stdout_lines }}"

    - name: 3️⃣  (Solo si la sintaxis es correcta) Mostrar las 100 últimas líneas del error.log general
      shell: tail -n 100 /var/log/apache2/error.log
      register: generic_errors
      when: configtest.rc == 0

    - debug:
        msg: "{{ generic_errors.stdout_lines }}"
      when: configtest.rc == 0
