---
- name: Diagn√≥stico de sintaxis Apache
  hosts: localhost          # o el grupo/host que corresponda
  become: true
  vars:
    base_dir: "/home/semaphore"
    fixed_file_url: "https://raw.githubusercontent.com/WordPress/WordPress/6.5.4/wp-includes/html-api/class-wp-html-tag-processor.php"
    ansible_remote_tmp: "/tmp/.ansible-123324453"
  tasks:

  - name: Buscar instalaciones con el plugin astra-sites activo
    shell: find /home/semaphore -maxdepth 4 -path "*/wp-content/plugins/astra-sites/inc/lib/astra-notices/class-astra-notices.php"
    register: astra_paths

  - name: Descargar archivo corregido class-astra-notices.php (compatible con PHP 8.3)
    get_url:
      url: https://raw.githubusercontent.com/brainstormforce/astra-sites/develop/inc/lib/astra-notices/class-astra-notices.php
      dest: "{{ item }}"
      mode: '0644'
    loop: "{{ astra_paths.stdout_lines }}"