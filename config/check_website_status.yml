- name: Ver estado de Apache + últimos 200 logs
  hosts: localhost
  become: true
  gather_facts: true

  vars:
    ansible_remote_tmp: "/tmp/.ansible-123324453"
    ansible_connection: local

    apache_service_name: "{{ 'httpd' if ansible_os_family == 'RedHat' else 'apache2' }}"
    error_log_patterns: "*error*.log"
    lines_to_show: 200
    log_paths:
      - "/var/log/{{ apache_service_name }}"
      - "/var/log/apache2"
      - "/var/log/httpd"

  tasks:
  # - name: Mostrar las primeras 300 líneas del error log de Apache
  #   shell: head -n 300 /var/log/apache2/error.log
  #   register: apache_error_head
  #   changed_when: false        # evita que Ansible marque la tarea como “changed”

  # - name: Imprimir salida del head
  #   debug:
  #     var: apache_error_head.stdout_lines
  - name: Deshabilitar vhost por defecto (000-default)
    shell: a2dissite 000-default.conf
    args:
      removes: /etc/apache2/sites-enabled/000-default.conf
    notify: restart apache
  