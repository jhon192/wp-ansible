---
- name: Reemplazar index.php con contenido WordPress
  hosts: localhost
  become: true

  vars:
    ansible_remote_tmp: "/tmp/.ansible-123324453"
  tasks:

  - name: Arreglar permisos de sitios
    file:
      path: "{{ item }}"
      recurse: yes
      state: directory
      mode: '0755'
      owner: www-data
      group: www-data
    loop: "{{ lookup('ansible.builtin.find', '/home/semaphore', recurse=False, file_type='directory').files | map(attribute='path') | list }}"

  - name: Arreglar permisos de archivos dentro de sitios
    file:
      path: "{{ item.path }}"
      mode: '0644'
      owner: www-data
      group: www-data
    with_fileglob:
      - "/home/semaphore/*/*"

